{% extends 'hotel_booking/base.html' %}
{% block content %}

<style>
  .contact-section {
    padding: 4rem 0;
    background: linear-gradient(to right, rgba(255,255,255,0.9), rgba(255,255,255,0.9)), url('/static/images/contact-bg.jpg');
    background-size: cover;
    background-position: center;
  }

  .contact-card, .contact-info-box {
    border-radius: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
  }

  .contact-info-box {
    padding: 2rem;
    background: #f8f9fa;
    margin-bottom: 2rem;
  }

  .contact-info-box:hover {
    transform: translateY(-5px);
  }

  .contact-icon {
    width: 50px;
    height: 50px;
    background: #dc3545;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    font-size: 1.2rem;
  }

  .form-control {
    border-radius: 10px;
    padding: 0.8rem 1rem;
  }

  .form-control:focus {
    box-shadow: 0 0 0 0.2rem rgba(220,53,69,0.25);
    border-color: #dc3545;
  }

  .btn-submit {
    padding: 0.8rem 2rem;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220,53,69,0.3);
  }

  .map-container {
    height: 300px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
  }
</style>

<div class="contact-section">
  <div class="container">
    <div class="text-center mb-5">
      <h1 class="display-4 fw-bold text-danger mb-3">Bize Ulaşın</h1>
      <p class="lead text-muted">Size yardımcı olmaktan mutluluk duyarız. Bizimle iletişime geçin!</p>
    </div>

    <div class="row g-4">
      <!-- İletişim Bilgileri -->
      <div class="col-lg-4">
        <div class="contact-info-box">
          <div class="contact-icon">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <h4 class="mb-3">Adres</h4>
          <p class="text-muted mb-0">Maslak, Büyükdere Cd. No:34398<br>Sarıyer/İstanbul</p>
        </div>

        <div class="contact-info-box">
          <div class="contact-icon">
            <i class="fas fa-phone"></i>
          </div>
          <h4 class="mb-3">Telefon</h4>
          <p class="text-muted mb-0">+90 242 123 45 67<br>+90 532 987 65 43</p>
        </div>

        <div class="contact-info-box">
          <div class="contact-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <h4 class="mb-3">E-posta</h4>
          <p class="text-muted mb-0">ornek@example.com<br>info@example.com</p>
        </div>
      </div>

      <!-- İletişim Formu -->
      <div class="col-lg-8">
        <div class="contact-card">
          <div class="card-body p-4">
            <form method="post" id="contactForm">
              {% csrf_token %}
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="name" class="form-label">İsim</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-0">
                      <i class="fas fa-user text-muted"></i>
                    </span>
                    <input type="text" class="form-control" id="name" name="name" placeholder="Adınızı girin" required>
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="email" class="form-label">E-posta</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-0">
                      <i class="fas fa-envelope text-muted"></i>
                    </span>
                    <input type="email" class="form-control" id="email" name="email" placeholder="E-posta adresinizi girin" required>
                  </div>
                </div>

                <div class="col-12">
                  <label for="subject" class="form-label">Konu</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-0">
                      <i class="fas fa-tag text-muted"></i>
                    </span>
                    <input type="text" class="form-control" id="subject" name="subject" placeholder="Konu başlığını girin" required>
                  </div>
                </div>

                <div class="col-12">
                  <label for="message" class="form-label">Mesajınız</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-0">
                      <i class="fas fa-comment text-muted"></i>
                    </span>
                    <textarea class="form-control" id="message" name="message" rows="5" placeholder="Mesajınızı buraya yazın" required></textarea>
                  </div>
                </div>

                <div class="col-12 text-end">
                  <button type="submit" class="btn btn-danger btn-submit">
                    <i class="fas fa-paper-plane me-2"></i>Mesaj Gönder
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Harita -->
        <div class="map-container mt-4">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12019.575913658741!2d28.974299299999998!3d41.112137!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab728fc42dd33%3A0x17d213078fb809f4!2zxLBzdGFuYnVsIE5pxZ9hbnRhxZ_EsSDDnG5pdmVyc2l0ZXNp!5e0!3m2!1str!2str!4v1710271144606!5m2!1str!2str"
            width="100%" 
            height="100%" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Başarı Modalı -->
<div class="modal fade" id="successModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0">
      <div class="modal-header bg-success text-white border-0">
        <h5 class="modal-title">
          <i class="fas fa-check-circle me-2"></i>Başarılı
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" style="border-radius: 40px;">
        <p class="mb-0" style="padding: 10px;">Mesajınız başarıyla gönderildi! En kısa sürede size dönüş yapacağız.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>

<!-- Hata Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="errorToast" class="toast" role="alert">
    <div class="toast-header bg-danger text-white">
      <i class="fas fa-exclamation-circle me-2"></i>
      <strong class="me-auto">Hata</strong>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body"></div>
  </div>
</div>

<script>
  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });

    function showErrorToast(message) {
      const toast = document.getElementById('errorToast');
      const toastBody = toast.querySelector('.toast-body');
      toastBody.textContent = message;
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
    }

    fetch('/hotel_booking/contact/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: JSON.stringify(data),
      credentials: 'same-origin'
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      if (data.success) {
        var successModal = new bootstrap.Modal(document.getElementById('successModal'));
        successModal.show();
        this.reset();
      } else {
        throw new Error(data.error || 'Bilinmeyen bir hata oluştu');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showErrorToast('Mesaj gönderilirken bir hata oluştu: ' + error.message);
    });
  });
</script>

{% endblock %}
